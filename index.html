<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PredictZone</title>

    <style>
        body { font-family: system-ui; padding: 20px; max-width: 700px; margin: auto; }
        .card { border: 1px solid #ccc; padding: 15px; border-radius: 12px; margin-top: 15px; }
        button { padding: 10px 14px; margin: 5px; border-radius: 8px; border: none; cursor: pointer; }
        button:disabled { opacity: 0.6; background: #999; }
        .btn { background: #007bff; color: white; }
        .result { font-weight: bold; margin-top: 10px; color: green; }
    </style>
</head>

<body>
<h2>PredictZone</h2>
<p style="color:#666">Live Poll System (Firebase)</p>

<div id="pollArea">Loading...</div>

<script type="module">

// ---------------------- Firebase Setup ----------------------
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc, onSnapshot } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBnnAWxLaphMhAG3F2Jkkd8s9CRrxXR828",
  authDomain: "predictzone-158ba.firebaseapp.com",
  projectId: "predictzone-158ba",
  storageBucket: "predictzone-158ba.firebasestorage.app",
  messagingSenderId: "132388290492",
  appId: "1:132388290492:web:d1108b70fe8188205df5b9",
  measurementId: "G-FJFLXNMH40"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ---------------------- Load Poll ----------------------
const POLL_ID = "Gz4BGIYYbXzHuCTGJvf";  // à¦¤à§‹à¦®à¦¾à¦° Firestore à¦¥à§‡à¦•à§‡ à¦¨à§‡à¦“à§Ÿà¦¾ à¦¡à¦•à§à¦®à§‡à¦¨à§à¦Ÿ à¦†à¦‡à¦¡à¦¿
const pollRef = doc(db, "polls", POLL_ID);

const pollArea = document.getElementById("pollArea");

// listen realtime
onSnapshot(pollRef, (snap) => {
    if (!snap.exists()) {
        pollArea.innerHTML = "No poll found.";
        return;
    }

    const data = snap.data();
    showPoll(data);
});

// ---------------------- Show Poll UI ----------------------
function showPoll(data) {

    const alreadyVoted = localStorage.getItem("voted_" + POLL_ID);

    let html = `
    <div class="card">
        <h3>${data.question}</h3>
        <p>Choose wisely ðŸ‘‡</p>
    `;

    data.Option.forEach(opt => {
        html += `
            <button class="btn" onclick="vote('${opt}')" ${alreadyVoted ? "disabled" : ""}>
                ${opt}
            </button>
        `;
    });

    html += `
        <div class="result">
            UP: ${data.votes.Up} votes <br>
            DOWN: ${data.votes.Down} votes
        </div>
    </div>
    `;

    pollArea.innerHTML = html;
}

// ---------------------- Voting Logic ----------------------
window.vote = async function(option) {

    const alreadyVoted = localStorage.getItem("voted_" + POLL_ID);
    if (alreadyVoted) {
        alert("You already voted!");
        return;
    }

    const snap = await getDoc(pollRef);
    const data = snap.data();

    // Increase vote count
    data.votes[option] += 1;

    await updateDoc(pollRef, { votes: data.votes });

    // Save localStorage so user canâ€™t vote twice
    localStorage.setItem("voted_" + POLL_ID, "yes");

    alert("Vote submitted!");
};

</script>
</body>
</html>
